CC = @CC@
CFLAGS = @CFLAGS@
CPPFALGS = @CPPFLAGS@
LDFLAGS = @LDFLAGS@

RST2MAN = @RST2MAN@

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
datarootdir = @datarootdir@
mandir = @mandir@

.PHONY: all
all: hungrycat

.PHONY: test
test: hungrycat
	python tests.py

.PHONY: clean
clean:
	rm -f hungrycat hungrycat.o
	rm -rf *.py[co] __pycache__

.PHONY: distclean
distclean: clean
	rm -f config.log config.status
	find . -name '*.in' | sed -e 's/[.]in$$//' | xargs -t rm -f

.PHONY: install
install: hungrycat
	install -D -m755 $(<) $(DESTDIR)$(bindir)/hungrycat

hungrycat: hungrycat.o
hungrycat.o: hungrycat.c config.h

ifneq "$(RST2MAN)" ""

manpage = doc/manpage.1

all: doc
clean: clean-doc
install: install-doc

.PHONY: doc
doc: $(manpage)

.PHONY: install-doc
install-doc: $(manpage)
	install -D -m644 $(<) $(DESTDIR)$(mandir)/man1/hungrycat.1

.PHONY: clean-doc
clean-doc:
	rm -f $(manpage)

%.1: %.rst
	@RST2MAN@ $(<) $(@).tmp
	sed -i -e "s/\([a-z]\)\\\\(aq\([a-z]\)/\1'\2/g" $(@).tmp  # prefer ' to \(aq when used as an apostrophe
	sed -i -e '/^[.][\]" vim:/d' $(@).tmp
	mv $(@).tmp $(@)

endif

# vim:ts=4 sts=4 sw=4 noet
